generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model CategorizationRule {
  id                    String   @id
  keyword               String   @unique
  categoryId            String
  rule_type             String
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  normalizedDescription String?
  Category              Category @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model Category {
  id                 String               @id
  name               String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  userId             String?              @db.Uuid
  CategorizationRule CategorizationRule[]
  User               User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  Transaction        Transaction[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model RawTransactions {
  belvo_id         String   @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  amount           Decimal  @db.Decimal
  raw_description  String?
  transaction_date DateTime @db.Timestamptz(6)
  type             String
  accountId        String?  @map("account_id")
  raw_payload      Json
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  status           String   @default("PENDING")
  id               String   @id
  user_id          String?  @db.Uuid
  account          Account? @relation(fields: [accountId], references: [id])
}

model Transaction {
  id                 String   @id
  description        String
  amount             Float
  categoryId         String
  date               DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  cleanedDescription String?
  userId             String?  @db.Uuid
  Category           Category @relation(fields: [categoryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  User               User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  accountId          String?  @map("account_id")
  account            Account? @relation(fields: [accountId], references: [id])
}

model User {
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  id          String        @id @db.Uuid
  email       String?       @unique
  Category    Category[]
  Transaction Transaction[]
  belvoLinks  BelvoLink[]

  @@map("User")
}

model BelvoLink {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  belvoLinkId String   @unique @map("belvo_link_id")
  institution String
  accessMode  String   @map("access_mode")
  status      String   @default("valid")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  accounts    Account[]

  @@map("belvo_links")
}

model Account {
  id              String        @id @default(cuid())
  belvoAccountId  String        @unique @map("belvo_account_id")
  name            String
  type            String
  balance         Float
  currency        String

  belvoLinkId     String        @map("belvo_link_id") @db.Uuid
  belvoLink       BelvoLink     @relation(fields: [belvoLinkId], references: [id], onDelete: Cascade)

  transactions    Transaction[]
  rawTransactions RawTransactions[]

  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@map("accounts")
}
